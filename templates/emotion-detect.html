<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emotion Detect</title>
    <!-- Favicons -->
    <link href="{{ url_for('static', filename='img/favicon.png') }}" rel="icon">
    <link href="{{ url_for('static', filename='img/apple-touch-icon.png') }}" rel="apple-touch-icon">

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
        rel="stylesheet">

    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

    <!-- Vendor CSS Files -->
    <link href="{{ url_for('static', filename='vendor/animate.css/animate.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='vendor/aos/aos.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='vendor/bootstrap/css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='vendor/bootstrap-icons/bootstrap-icons.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='vendor/boxicons/css/boxicons.min.cs') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='vendor/glightbox/css/glightbox.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='vendor/remixicon/remixicon.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='vendor/swiper/swiper-bundle.min.css') }}" rel="stylesheet">

    <!-- Template Main CSS File -->
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>

<body>
    <!-- ======= Header ======= -->
    <header id="header" class="fixed-top d-flex align-items-center  header-transparent ">
        <div class="container d-flex align-items-center justify-content-between">

            <div class="logo">
                <img style="width: 150px; height: 100px;" src="{{ url_for('static', filename='logo.png') }}" alt=""><a
                    href="/"></a></img>
            </div>

            <nav id="navbar" class="navbar">
                <ul>
                    <li><a class="nav-link scrollto" href="/">Trang chủ</a></li>
                    <li><a class="nav-link scrollto" href="/cam_detect">Phân loại cảm xúc</a></li>
                    <li><a class="nav-link scrollto" href="/list">Dữ liệu đã lưu</a></li>
                </ul>
                <i class="bi bi-list mobile-nav-toggle"></i>
            </nav><!-- .navbar -->

        </div>
    </header><!-- End Header -->
    <!-- ======= Hero Section ======= -->
    <section id="hero" class="d-flex flex-column justify-content-end align-items-center">
        <div id="heroCarousel" data-bs-interval="5000" class="container carousel carousel-fade" data-bs-ride="carousel">

            <!-- Slide 1 -->
            <div class="carousel-item active">
                <div class="carousel-container">
                    <h2 class="animate__animated animate__fadeInDown">Phân loại cảm xúc</h2>
                    <p class="animate__animated fanimate__adeInUp">Bấm "Start" để mở webcam nhận diện khuôn
                        mặt của bạn và phân loại cảm xúc
                    </p>
                </div>
            </div>

            <!-- Slide 2 -->
            <div class="carousel-item">
                <div class="carousel-container">
                    <h2 class="animate__animated animate__fadeInDown">Tắt camera</h2>
                    <p class="animate__animated animate__fadeInUp">Bấm Stop để tắt webcam</p>
                </div>
            </div>

            <!-- Slide 3 -->
            <div class="carousel-item">
                <div class="carousel-container">
                    <h2 class="animate__animated animate__fadeInDown">Hiển thị kết quả</h2>
                    <p class="animate__animated animate__fadeInUp">Kết quả sau khi tắt cam sẽ được hiển thị bên cạnh</p>
                </div>
            </div>

            <a class="carousel-control-prev" href="#heroCarousel" role="button" data-bs-slide="prev">
                <span class="carousel-control-prev-icon bx bx-chevron-left" aria-hidden="true"></span>
            </a>

            <a class="carousel-control-next" href="#heroCarousel" role="button" data-bs-slide="next">
                <span class="carousel-control-next-icon bx bx-chevron-right" aria-hidden="true"></span>
            </a>

        </div>

        <svg class="hero-waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
            viewBox="0 24 150 28 " preserveAspectRatio="none">
            <defs>
                <path id="wave-path" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z">
            </defs>
            <g class="wave1">
                <use xlink:href="#wave-path" x="50" y="3" fill="rgba(255,255,255, .1)">
            </g>
            <g class="wave2">
                <use xlink:href="#wave-path" x="50" y="0" fill="rgba(255,255,255, .2)">
            </g>
            <g class="wave3">
                <use xlink:href="#wave-path" x="50" y="9" fill="#fff">
            </g>
        </svg>

    </section><!-- End Hero -->

    <main on id="main"
        style="text-align: center; margin-top: 30px; margin-bottom: 20px; display: flex; justify-content: center;">
        <div id="id1">
            <h1>Emotion Detection</h1>
            <img id="videoFeed" width="640" height="480">
            <br>
            <div style="margin-top: 10px; margin-bottom: 10px;">
                <button type="button" class="btn btn-success" onclick="startDetection()"><i class="bi bi-caret-right"></i> Start</button>
                <button type="button" class="btn btn-danger" onclick="stopDetection()"><i class="bi bi-camera-video-off"></i> Stop</button>
            </div>
        </div>

        <hr style="margin-left: 40px; margin-top: 40px; border: none; border-left: 1px solid #ccc;">
        <div style="margin-left: 20px; margin-top: 40px;">
            <h4>Kết quả</h4>
            <div id="result"></div>
            <br>
            <div id="controlDiv"></div>
        </div>

    </main>

    <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
            class="bi bi-arrow-up-short"></i></a>

    <!-- ======= Footer ======= -->
    <footer id="footer">
        <div class="container">
            <div class="social-links">
                <a href="#" class="twitter"><i class="bx bxl-twitter"></i></a>
                <a href="#" class="facebook"><i class="bx bxl-facebook"></i></a>
                <a href="#" class="instagram"><i class="bx bxl-instagram"></i></a>
                <a href="#" class="google-plus"><i class="bx bxl-skype"></i></a>
                <a href="#" class="linkedin"><i class="bx bxl-linkedin"></i></a>
            </div>
            <div class="credits">
                NGUYỄN HOÀNG ANH
            </div>
        </div>
    </footer><!-- End Footer -->
    <!-- Vendor JS Files -->
    <script src="{{ url_for('static', filename='vendor/aos/aos.js') }}"></script>
    <script src="{{ url_for('static', filename='vendor/bootstrap/js/bootstrap.bundle.min.js') }}"></script>
    <script src="{{ url_for('static', filename='vendor/glightbox/js/glightbox.min.js') }}"></script>
    <script src="{{ url_for('static', filename='vendor/isotope-layout/isotope.pkgd.min.js') }}"></script>
    <script src="{{ url_for('static', filename='vendor/swiper/swiper-bundle.min.js') }}"></script>
    <script src="{{ url_for('static', filename='vendor/php-email-form/validate.js') }}"></script>

    <!-- Template Main JS File -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        var videoFeed;
        var resultDiv;
        var controlDiv;
        var streaming = false;

        document.addEventListener('DOMContentLoaded', function() {
            videoFeed = document.getElementById('videoFeed');
            resultDiv = document.getElementById('result');
            controlDiv = document.getElementById('controlDiv');
        });

        function toggleSchedule() {
            var scheduleForm = document.getElementById('scheduleForm');
            scheduleForm.style.display = scheduleForm.style.display === 'none' ? 'block' : 'none';
        }

        function startDetection() {
            if (!streaming) {
                fetch('/start_detection')
                    .then(response => response.text())
                    .then(data => {
                        console.log(data);
                    });
                videoFeed.src = '/video_feed';
                streaming = true;
            } else {
                console.log("Already streaming.");
            }
        }

        function stopDetection() {
            if (streaming) {
                fetch('/stop_detection')
                    .then(response => response.text())
                    .then(data => {
                        resultDiv.innerHTML = data;
                        showControlButtons(data);
                    });
                videoFeed.src = '';
                streaming = false;
            } else {
                console.log("Not currently streaming.");
            }
        }

        function showControlButtons(result) {
            if (result.trim() !== "") {
                controlDiv.innerHTML = `
                    <button type="button" class="btn btn-primary" onclick="saveResult('${result}')">Lưu</button>
                    <button type="button" class="btn btn-secondary" onclick="clearResult()">Xóa</button>
                `;
            }
        }

        function saveResult(result) {
            fetch('/save_scan', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: 'result=' + encodeURIComponent(result)
            })
            .then(response => response.text())
            .then(data => {
                alert(data);
            });
        }

        function clearResult() {
            resultDiv.innerHTML = "";
            controlDiv.innerHTML = "";
        }
    </script>
</body>

</html>